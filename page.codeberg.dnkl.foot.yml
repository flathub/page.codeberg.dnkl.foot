app-id: page.codeberg.dnkl.foot
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: foot-wrapper.sh
finish-args:
  - --device=dri
  - --socket=wayland
  - --talk-name=org.freedesktop.Flatpak
rename-desktop-file: foot.desktop
rename-icon: foot
cleanup:
  - /etc
  - /include
  - /lib/pkgconfig
  - /share/bash-completion
  - /share/doc
  - /share/fish
  - /share/zsh
modules:
  # host-spawn is a tool required to run host terminal from flatpak sandbox
  - name: host-spawn
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOBIN: /app/bin
        GOFLAGS: -modcacherw
        GOPATH: /run/build/host-spawn
    sources:
      - type: git
        url: https://github.com/1player/host-spawn
        commit: d76c3a5196a8e0943f6a1c7c9f1acde4bd83c40c
        tag: v1.6.2
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      # The below dependencies needs to be manually updated, adding to external checker could result on a break build
      - dest: vendor
        path: modules.txt
        type: file
      - type: git
        dest: vendor/github.com/godbus/dbus/v5
        url: https://github.com/godbus/dbus.git
        commit: e523abc905595cf17fb0001a7d77eaaddfaa216d
        tag: v5.1.0
      - type: git
        dest: vendor/github.com/pkg/term
        url: https://github.com/pkg/term.git
        commit: d02e49dd31404f3c3cf4b5469b28942194e0ca23
        tag: v1.1.0
      - type: git
        dest: vendor/golang.org/x/sys
        url: https://go.googlesource.com/sys.git
        commit: 13b15b780d9013988b1fb0e79e30b2528a877638
        tag: v0.15.0
    build-commands:
      - go install -mod=vendor -ldflags "-X main.Version=$(git describe --tags)"
  - name: libutf8proc
    builddir: true
    buildsystem: cmake
    sources:
      - type: git
        url: https://github.com/JuliaStrings/utf8proc.git
        commit: 90daf9f396cfec91668758eb9cc54bd5248a6b89
        tag: v2.11.2
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
  - name: tllist
    builddir: true
    buildsystem: meson
    sources:
      - type: git
        url: https://codeberg.org/dnkl/tllist.git
        commit: 8dcb0725c73eee9e350f41a921faf0bcd2ab9920
        tag: 1.1.0
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
  - name: fcft
    builddir: true
    buildsystem: meson
    config-opts:
      - -Dgrapheme-shaping=enabled
      - -Drun-shaping=enabled
    sources:
      - type: git
        url: https://codeberg.org/dnkl/fcft.git
        commit: b212e767e031891687bc6f5527ab61dddac6024e
        tag: 3.3.2
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
  - name: foot
    builddir: true
    buildsystem: meson
    config-opts:
      - -Dterminfo=disabled
    post-install:
      - desktop-file-edit --set-key="Exec" --set-value="foot-wrapper.sh" "/app/share/applications/foot.desktop"
      - install -Dm755 ../foot-wrapper.sh -t /app/bin/
      - install -Dm644 ../page.codeberg.dnkl.foot.metainfo.xml -t /app/share/metainfo/
    sources:
      - type: git
        url: https://codeberg.org/dnkl/foot.git
        commit: b44a62724cd51c7fecdfd9d1b41a3691b11a4c27
        tag: 1.25.0
        x-checker-data:
          type: git
          tag-pattern: ^([\d.]+)$
      - type: file
        path: foot-wrapper.sh
      - type: patch
        path: upstream-metainfo.patch
