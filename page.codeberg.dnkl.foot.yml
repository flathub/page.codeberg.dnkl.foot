app-id: page.codeberg.dnkl.foot
runtime: org.freedesktop.Platform
runtime-version: "24.08"
sdk: org.freedesktop.Sdk
sdk-extensions:
  - org.freedesktop.Sdk.Extension.golang
command: foot-wrapper.sh
finish-args:
  - --device=dri
  - --socket=wayland
  - --talk-name=org.freedesktop.Flatpak
rename-desktop-file: foot.desktop
rename-icon: foot
cleanup:
  - /etc
  - /include
  - /lib/pkgconfig
  - /share/bash-completion
  - /share/doc
  - /share/fish
  - /share/zsh
modules:
  # host-spawn is a tool required to run host terminal from flatpak sandbox
  - name: host-spawn
    buildsystem: simple
    build-options:
      append-path: /usr/lib/sdk/golang/bin
      env:
        GOBIN: /app/bin
        GOFLAGS: -modcacherw
        GOPATH: /run/build/host-spawn
    sources:
      - type: git
        url: https://github.com/1player/host-spawn
        commit: d76c3a5196a8e0943f6a1c7c9f1acde4bd83c40c
        tag: v1.6.2
        x-checker-data:
          type: git
          tag-pattern: ^v([\d.]+)$
      # The below dependencies needs to be manually updated, adding to external checker could result on a break build
      - dest: vendor
        path: modules.txt
        type: file
      - type: git
        dest: vendor/github.com/godbus/dbus/v5
        url: https://github.com/godbus/dbus.git
        commit: e523abc905595cf17fb0001a7d77eaaddfaa216d
        tag: v5.1.0
      - type: git
        dest: vendor/github.com/pkg/term
        url: https://github.com/pkg/term.git
        commit: d02e49dd31404f3c3cf4b5469b28942194e0ca23
        tag: v1.1.0
      - type: git
        dest: vendor/golang.org/x/sys
        url: https://go.googlesource.com/sys.git
        commit: 13b15b780d9013988b1fb0e79e30b2528a877638
        tag: v0.15.0
    build-commands:
      - go install -mod=vendor -ldflags "-X main.Version=$(git describe --tags)"
  - name: tllist
    builddir: true
    buildsystem: meson
    sources:
      - type: archive
        url: https://codeberg.org/dnkl/tllist/archive/1.1.0.tar.gz
        sha256: 0e7b7094a02550dd80b7243bcffc3671550b0f1d8ba625e4dff52517827d5d23
  - name: fcft
    builddir: true
    buildsystem: meson
    sources:
      - type: archive
        url: https://codeberg.org/dnkl/fcft/archive/3.1.10.tar.gz
        sha256: 4f4807d708f3a195e9a3caaa1ff9171b678af63a7af1c470a8984d601a4514de
  - name: foot
    builddir: true
    buildsystem: meson
    config-opts:
      - -Dterminfo=disabled
    post-install:
      - desktop-file-edit --set-key="Exec" --set-value="foot-wrapper.sh" "/app/share/applications/foot.desktop"
      - install -Dm755 ../foot-wrapper.sh -t /app/bin/
      - install -Dm644 ../page.codeberg.dnkl.foot.metainfo.xml -t /app/share/metainfo/
    sources:
      - type: archive
        url: https://codeberg.org/dnkl/foot/archive/1.20.2.tar.gz
        sha256: 9a8832e2485923c8a79e77958c8b0357abd159dfa8958609402362da8e56c073
      - type: file
        path: foot-wrapper.sh
      - type: patch
        path: upstream-metainfo.patch
